# 동기와 비동기 (프로세스 동기화)

일반적으로 동기와 비동기의 차이는 메소드를 실행시킴과 동시에 반환 값이 기대되는 경우를 동기 라고 표현하고 그렇지 않은 경우 비동기라고 한다. '동시에' 라는 말은 실행되었을 때 값을 반환되기 전까지 블록킹되어 있다는 것을 의미한다. 비동기의 경우 반환 값을 기다리지 않고 바로 이벤트 큐에 넣거나 백그라운드 스레드에 해당 태스크를 위임하고 다음 코드를 실행하기 때문에 바로 반환되지 않는다.





## Critical Section(임계영역)

멀티 스레딩에 문제점에서 나오듯, 동일 자원을 동시에 접근하는 작업(공유 변수, 동일 파일)을 실행하는 코드 영역을 임계영역이라고 한다.



## 임계영역 문제 

프로세스들이 Critical Section을 함께 사용할 수 있는 프로토콜을 설계하는 것이다.

Requirements(해결을 위한 기본조건)

- Mutual Exclusion(상호 배제)

  프로세스 P1이 임계영역에서 실행 중이라면, 다른 프로세스들은 그들이 가진 임계 영역에서 실행될 수 없다.

- Progress(진행)

  Critical Section에서 실행중인 프로세스가 없고 별도 동작이 없는 프로세스들만 Critical Section 진입 후보로 참여될 수 있다.

- Bounded Waiting

  P1이 Critical Section에 진입 신청 후부터 받아들여질 때까지, 다른 프로세스들이 Critical Section에 진입하는 횟수 제한이 있어야한다.



## 해결책

### Lock

- 하드웨어 기반 해결책으로, 동시에 공유 자원에 접근하는 것을 막기 위해 Critical Section에 진입하는 프로세스는 Lock을 획득하고 Critical Section을 빠져나올 때 Lock을 방출함으로써 동시 접근이 되지 않도록 한다.

#### 한계

- 다중처리 환경에서 시간적 효율성 측면에 적용할 수 없다.





### Semaphores(세마포어)

- 소프트웨어 상에 Critical 문제를 해결하기 위한 동기화 도구

#### 종류

- Counting Semaphores : 가용한 개수를 가진 자원에 대한 접근 제어용으로 사용되며, 세마포는 그 가용한 자원의 개수로 초기화된다. 자원을 사용하면 세마포가 감소, 방출하면 세마포가 증가한다.
- Binary Semaphores(이진 세마포, Mutex) : 상포배제의 Mutual Exclusion의 머리글자를 따서 만들어졌다. 이름 그대로 0과 1사이의 값만 가능하며, 다중 프로세스들 사이의 Critical Section 문제를 해결하기 위해 사용한다.



#### 단점

- Busy Waiting : Spin lock이라 불리는 Semaphore 초기 버전에서 Critical Section에 진입해야하는 프로세스는 진입 코드를 계속 반복 실행해야 하며, CPU 시간을 낭비했었다. 이를 Busy Waiting이라고 부르며 특수한 상황이 아니면 비효율적이다. 일반적으로 Semaphore에서 Critical Section에 진입을 시도했지만 실패한 프로세스에 대해



#### 교착상태(Deadlock)

- 세마포가 Ready Queue를 가지고 있고, 둘 이상의 프로세스가 Critical Section 진입을 무한정 기다리고 있고, Critical Section에서 실행되는 프로세스는 진입 대기 중인 프로세스가 실행되어야만 빠져나올 수 있는 상황.

데드락 발생의 필요 조건 4가지

1) Mutual Exclusion 상호배제 : 프로세서들이 자원을 배타적으로 점유, 다른 프로세서들이 자원을 사용 불가, 한 번에 한 프로세스만이 자원 사용이 가능

2) Hold and wait 점유와 대기 : 부분 할당, 다른 종류의 자원을 부가적으로 요구하면서, 이미 어떤 자원을 점유 중

3) No preemption 비선점 : 자원들은 그들을 점유하고 있는 프로세스로부터 도중에 해체되지 않음

4) Circular Wait 환형대기 : 프로세스와 자원들이 원형을 이루며, 각 프로세스는 자신에게 할당된 자원을 가지면서, 상대방 프로세스의 자원을 상호 요청하는 경우



해결방법 4가지

1) 예방 : 말 그대로 데드락이 발생할 가능성이 없게 알고리즘을 생성

2) 회피 : 데드락이 빠질 가능성이 있는지 운영체제가 검사를 하고 빠질 가능성이 없을 경우만 실행

3) 발견과 회복 : 교착상태 프로세스를 모두 중지하거나, 교착 상태가 해결될때까지 한 프로세스씩 중지

4) 아무 것도 안함 : 교착상태를 해결할때도 컨텍스트 교환에 의해 오버헤드로 성능저하가 생긴다, 해결할때 성능저하가 더 큰 경우 그냥 무시한다.



#### 모니터

- 고급 언어의 설계 구조물, 개발자의 코드를 상호배제 하게끔 만듬 추상화된 데이터 형태
- 공유 자원에 접근하기 위한 키획득과 자원 사용 후 해제를 모두 처리한다.(세마포어는 직접 키 해제와 공유자원 접근 처리가 필요하다.)